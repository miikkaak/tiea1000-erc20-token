<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MGT UI</title>
    <script src=".\node_modules\truffle-blockchain-utils\node_modules\web3\dist\web3.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./index.scss">
</head>

<body>
	<div class="container">

    	<h1>MiggersToken</h1>
    	<script src="./bundle.js"></script>
    	<h2>Send tokens</h2>
    	<label for="to">Address to send the tokens: </label>
    	<input type="text" id="to">
    	<br><br>
    	<label for="amount">Amount: </label>
    	<input type="text" id="amount">
    	<button id="confirm">Send</button>
    	<p>WARNING! Notice that sent transactions cannot be reverted.</p>
    	<h2 id="message">
    		<img id="loader" src="http://users.jyu.fi/~mialkivi/img/loader.gif">
    	</h2>
	</div>

	<div class="credit">
		<p>Business image created by Kjpargeter - Freepik.com</p>
	</div>
	
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

	<script>
		if (typeof web3 !== 'undefined') {
 			 web3 = new Web3(web3.currentProvider);
		} else {
  			web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:9545"));
		}

		web3.eth.defaultAccount = web3.eth.accounts[0];

		var tokenContract = web3.eth.contract(
			[
    {
      "constant": true,
      "inputs": [],
      "name": "name",
      "outputs": [
        {
          "name": "",
          "type": "string"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "",
          "type": "address"
        }
      ],
      "name": "balances",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "decimals",
      "outputs": [
        {
          "name": "",
          "type": "uint8"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "short",
      "outputs": [
        {
          "name": "",
          "type": "string"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "name": "from",
          "type": "address"
        },
        {
          "indexed": false,
          "name": "to",
          "type": "address"
        },
        {
          "indexed": false,
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "Sent",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "name": "tokenOwner",
          "type": "address"
        },
        {
          "indexed": true,
          "name": "spender",
          "type": "address"
        },
        {
          "indexed": false,
          "name": "tokens",
          "type": "uint256"
        }
      ],
      "name": "Approval",
      "type": "event"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "spender",
          "type": "address"
        },
        {
          "name": "tokens",
          "type": "uint256"
        }
      ],
      "name": "approve",
      "outputs": [
        {
          "name": "success",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "to",
          "type": "address"
        },
        {
          "name": "tokens",
          "type": "uint256"
        }
      ],
      "name": "transfer",
      "outputs": [
        {
          "name": "success",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "tokenOwner",
          "type": "address"
        },
        {
          "name": "spender",
          "type": "address"
        }
      ],
      "name": "allowance",
      "outputs": [
        {
          "name": "remaining",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "from",
          "type": "address"
        },
        {
          "name": "to",
          "type": "address"
        },
        {
          "name": "tokens",
          "type": "uint256"
        }
      ],
      "name": "transferFrom",
      "outputs": [
        {
          "name": "success",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "tokenOwner",
          "type": "address"
        }
      ],
      "name": "balanceOf",
      "outputs": [
        {
          "name": "balance",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "totalSupply",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    }
  ]);

		var Token = tokenContract.at('0x345ca3e014aaf5dca488057592ee47305d9b3e10');
		console.log(Token);

		var sendEvent = Token.Sent();

		sendEvent.watch(function(error, result) {
			if (!error) {
					$("#loader").hide();
					$("#message").html(result.args.amount + " sent from address: " + result.args.from + " to address: " + result.args.to)
			} else {
				$("#loader").hide();
				console.log(error);
				$("#message").html("Error occured while sending the transaction!")
			}
		});

		$("#confirm").click(function(){
			Token.transfer($("#to").val(), $("#amount").val());
		});
	</script>
</body>

</html>